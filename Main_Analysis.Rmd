---
title: "COVID-19 Analysis in South Korea"
author: "Group 86 - Jana Schneider, Jana Jeggle, Felix Heim, Leon Gaertner"
date: "4 12 2020"
output:
  html_document: default
  pdf_document: default
---

<p>&nbsp;</p>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r , echo=FALSE, message=FALSE}

# #general libraries
# install.packages("magrittr")
# install.packages("data.table")
# install.packages("ggplot2")
# install.packages("tidyr")
# install.packages("dplyr")
# install.packages("ggpubr")
# 
# #required libraries for Claim 2
# install.packages("maps")
# install.packages("ggrepel")
# install.packages("rgeos")
# install.packages("sf")
# install.packages("rnaturalearth")
# install.packages("rnaturalearthdata")

# #required libraries for Claim 4
# install.packages("patchwork")
# install.packages("hrbrthemes")

```

```{r echo = TRUE, message=FALSE}

#general libraries
library(magrittr)
library(data.table)
library(ggplot2)
library(tidyr)
library(dplyr)
library(ggpubr)
#required libraries for Claim 1
library(patchwork)
library(hrbrthemes)
#required libraries for Claim 3
library(maps)
library(ggrepel)
library(rgeos)
library(sf)
library(rnaturalearth)
library(rnaturalearthdata)

```

```{r  echo=TRUE, message=FALSE}
#import data files
time <- fread("./extData/Time.csv")
policy <- fread("./extData/Policy.csv")
policy1 <- fread("./extData/Policy.csv")
RKI_data <- fread("./extData/DE_InfectionCases.csv")
patientinfo <- fread("./extData/PatientInfo.csv")
case <- fread("./extData/Case.csv")
searchtrend <- fread("./extData/SearchTrend.csv")
region <- fread("./extData/Region.csv")
weather <- fread("./extData/Weather.csv")
timeProvince <- fread("./extData/TimeProvince.csv")

```

```{r echo=FALSE}

#hide warning messages
options(warn=-1)

```
<p>&nbsp;</p>


## Initial Motivation

```{r echo=FALSE, message=FALSE, include=FALSE, message=FALSE}
#total cases in Korea per day
time[,confirmed_date:=as.Date(date,"%d/%m/%y")]
time[, confirmed_date:= as.IDate(confirmed_date)]

# total cases Germany

RKI_data_UsFormat <- RKI_data[, confirmed_date := as.Date(`Berichtsdatum`, 
                                                          format ="%d.%m.%y")]
#change date class to "IDate"
RKI_data_UsFormat[, confirmed_date:= as.IDate(confirmed_date)]
RKI_data_UsFormat <- RKI_data_UsFormat[, Berichtsdatum := NULL]



merge_GermanyUS <- merge(RKI_data_UsFormat, time, 
                         by = "confirmed_date", all.y = TRUE)

# plot
plot_germany <- ggplot(merge_GermanyUS, aes(x=confirmed_date)) + 
  geom_line(aes(y=`daily_cases`,color="South Korea"))+
  geom_line(aes(y=`Anzahl COVID-19-Faelle pro Tag`,color="Germany")) + 
  labs(x= "Date", y="Cases per Day",title="Daily Cases: South Korea vs. Germany") + 
  scale_color_manual(values=c( "orange", "black", "blue","red"))+
  theme(legend.position="bottom") +
  theme(legend.title=element_blank()) 

```

```{r  echo=FALSE}
plot(plot_germany)
```


* After a massive increase in the number of daily cases, it appears that the government of South Korea was able to reduce the number of daily cases remarkably within a few days and continued to retain a constant low level.
* The total number of daily cases in South Korea compared to Germany is considerably lower. Considering the population of each country(~50 Mio. vs. 80 Mio.) this seems to be an outstanding achievement.
* Therefore, we aim to investigate how South Korea was able to achieve these results. 


<p>&nbsp;</p>


## Claim 01 
#### The more active measures imposed from the government of South Korea, the lower the number of daily cases. 

**Our initial motivation:**

* As the number of infection cases in South Korea increased heavily, the government became more active in terms of measures with the aim to decrease the number of daily infection cases.

**Claim description in more detail:**

* XXX

**Our approach:**

* First, we inspect the different types of measures and wehn they were imposed from the government during the period from January 2020 to July 2020. 
* Then, we show a specific types of measures in more detail
* Finally, we inspect whether there is a association between the number of measurements and the development of the number of daily infection cases.

<p>&nbsp;</p>


```{r echo = FALSE, message=FALSE}

policy_copy = copy(policy)
nbPolicies <- policy_copy[, .N, by=type] %>% setorder(., -N) 

plot_nbPolicies <- ggplot(nbPolicies, aes(x = reorder(type, N) ,y = N)) +
  geom_bar(stat="identity", width = 0.7) + 
  coord_flip() +
  labs(x = "Type of Policy", y = "Number of Measures",
       title="Different Policies")+
  theme(legend.position="none") 


#Policy Starting Day Distribution
policy_copy = copy(policy)
policyDay = policy_copy[, c("policy_id", "country", "type", "detail", "end_date") := NULL]

policyDay <- policyDay[, count := .N, by=start_date]

plot_polDistribution <- ggplot(policyDay, aes(x = start_date)) +
  scale_x_date(date_breaks = "1 month", date_labels = "%b %y") +
  geom_bar() +
  labs(x = "Time", y = "Number of Measures",
       title="Start of the Measures")+
  theme(legend.position="none") +
  geom_text(aes(label=stat(count)), stat = "count", vjust = -0.5)

ggarrange(plot_nbPolicies, plot_polDistribution, ncol=2, nrow=1)

```

**Short Analysis**

* The number of immigration and education policies dominate the other measures. This is related to the fact that immigration measures are counted for each country and education measures for each school type.

* Shortly after the number of infection cases surged the government of South Korea reacted with numerous measures in all kind of area. The many measures in the middle of April are related to the Online-school opening measures that all took place at once for each type of school. 

 
<p>&nbsp;</p>

```{r echo=FALSE, message=FALSE}
time_copy = copy(time)
#total cases in Korea per day
time_copy[,confirmed_date:=as.Date(date,"%d/%m/%y")]
time_copy[, confirmed_date:= as.IDate(confirmed_date)]


#extract education measures from table policy
date_education <- policy[type == "Education"]


#plot start of education policies +
#administration policies +
#social policies
#on infection cases per day within the time frame 

ggplot(time_copy, aes(x=confirmed_date, y=daily_cases)) + geom_line() +
  
  #education policies
  
  geom_rect(aes(xmin=as.Date('2020-03-02'),xmax=as.Date('2020-04-06'),
                ymin=740,ymax=743,color="School delay"))+
  geom_text(aes(x = as.Date('2020-03-02'), y = 750, label = "School delay"),
    size = 3, vjust = 0, hjust = 0, color = "black")+
  
  geom_rect(aes(xmin=as.Date('2020-04-09'),xmax=as.Date('2020-06-08'),
                ymin=740,ymax=743,color="Online classes"))+  
  geom_text(aes(x = as.Date('2020-04-09'), y = 750, label = "Online classes"),
            size = 3, vjust = 0, hjust = 0, color = "black")+
  
  #social policies 
  
  geom_rect(aes(xmin=as.Date('2020-02-29'),xmax=as.Date('2020-04-19'),
                ymin=840,ymax=843,color="Strong social\ndistancing campaign"))+
  geom_text(aes(x = as.Date('2020-02-29'), 
                y = 850, label = "Strong Social distancing campaign"),
            size = 3, vjust = 0, hjust = 0, color = "black")+
  
  geom_rect(aes(xmin=as.Date('2020-04-19'),xmax=as.Date('2020-06-30'),
                ymin=840,ymax=843,color="Weak social\ndistancing campaign"))+
  geom_text(aes(x = as.Date('2020-05-01'), 
                y = 850, label = "Weak social distancing campaign"),
            size = 3, vjust = 0, hjust = 0, color = "black")+
  
  #administrative policies
  
  geom_rect(aes(xmin=as.Date('2020-05-08'),xmax=as.Date('2020-06-07'),
                ymin=110,ymax=113,color="Close bars\nand clubs"))+
  geom_text(aes(x = as.Date('2020-05-08'), 
                y = 120, label = "Close bars and clubs"),
            size = 3, vjust = 0, hjust = 0, color = "black")+
  geom_rect(aes(xmin=as.Date('2020-05-16'),xmax=as.Date('2020-06-30'),
                ymin=170,ymax=173,color="Local government\nadministrative orders"))+
  geom_text(aes(x = as.Date('2020-05-16'), 
                y = 180, label = "Local gov. administrative orders"),
            size = 3, vjust = 0, hjust = 0, color = "black")+
  geom_rect(aes(xmin=as.Date('2020-05-21'),xmax=as.Date('2020-06-03'),
                ymin=230,ymax=233,color="Close karaoke"))+
  geom_text(aes(x = as.Date('2020-05-21'), 
                y = 240, label = "Close karaoke"),
            size = 3, vjust = 0, hjust = 0, color = "black")+
  
  labs(x = "Time", y = "Cases per Day",
       title="Administrative / Education / Social Measures")+
  theme(legend.position="none") 

```

**Short Analysis**

* After the number of daily cases have reached peak in March, numerous meausures with the aim of social distancing, such as delaying school start, were introduced. It seems that through these measures the number of daily cases could be reduced.
* In the beginning of May, after the number of daily cases tended to increase again, further public indoor gathering places were forced closed. It seems that through that another severe outbreak was prevented.

<p>&nbsp;</p>


```{r echo=FALSE, message=FALSE}

# Policies: cumulative Measures per Day
policy_copy <- copy(policy) 

policy_day_start <- policy_copy[,.(start_date)]  %>% .[,.N,by = "start_date"]
colnames(policy_day_start) <- c("date","number")

policy_day_end <- policy_copy[,.(end_date)] %>% .[,.N,by = "end_date"]
colnames(policy_day_end) <- c("date","number")
policy_day_end <- na.omit(policy_day_end, "date")

#Merge data and only retain the relevant ones and replace NAs with 0
merge_StartEnd <- merge(x = policy_day_start, y = policy_day_end, by = "date", all = TRUE)
colnames(merge_StartEnd) <- c("date","newMeasures","stoppedMeasures")
merge_StartEnd[is.na(merge_StartEnd)] <- 0

#get difference between policies that started and ended at a certain day
merge_StartEnd[, difference := .(newMeasures - stoppedMeasures)]

#Including daily number of infection cases from table "time"
time_copy = copy(time)
time_copy[,confirmed_date:=as.Date(date,"%d/%m/%y")]
time_copy[, confirmed_date:= as.IDate(confirmed_date)]
time <- time[,.(confirmed_date, daily_cases)]
colnames(time) <- c("date", "daily_cases")

#merge number of cum. measures and daily cases
merge_CasesMeasures <- 
  merge(x = time, y = merge_StartEnd, by = "date", all.x = TRUE)
merge_CasesMeasures[is.na(merge_CasesMeasures)] <- 0

merge_CasesMeasures[, cumulativeNumbers := cumsum(difference)]

# Plot "daily cases" and "cum. number of measures" on two different y axis
ggplot(merge_CasesMeasures, aes(x = date)) +
  scale_x_date(date_breaks = "1 month", date_labels = "%b %y") +
  geom_line(aes(y=`daily_cases`, col = "Daily Cases")) +
  geom_line(aes(y=`cumulativeNumbers` * 8,col = "Cum. Measures")) + 
  labs(title="Daily Cases and Number of Measures", x = "Time") +
  scale_y_continuous(name = "Cases per Day",
  # Add a second axis, with a scale / 8
  sec.axis = sec_axis(~./ 8, name="Number of cum. Measures")) +
  theme(legend.position="right", legend.title = element_blank(), 
        axis.title.y.right = element_text(angle=90))


#Calculate statistics
#Correlation 
cor_CasesMeasures <- cor(merge_CasesMeasures$cumulativeNumbers, merge_CasesMeasures$daily_cases, method = 'spearman')
cor_CasesMeasures

#Cross-correlation
ccfValues <- ccf(merge_CasesMeasures$cumulativeNumbers,merge_CasesMeasures$daily_cases, 50)
```



**Interpretation:**

* The correlations in this region are negative, indicating that an above 
average value of measures is likely to lead to a below average value of daily cases 
about 30 days later. 
* And, a below average of measures is associated with a likely above average daily cases value about 6 months later.


<p>&nbsp;</p>

```{r echo=FALSE, message=FALSE}


#Test - Statistics
test <-cor.test(merge_CasesMeasures$cumulativeNumbers, 
                merge_CasesMeasures$daily_cases,method="spearman")
test

p_value <- test$p.value
p_value

```

<p>&nbsp;</p>

## Claim 02
#### Superspreader Events were the reason the Covid cases in South Korea turned out to be so intense in the first place.

**Our initial motivation:**

* When Covid first reach South Korea the number of cases was relatively low. However, with the "mysterious" patient Number 31, the serious increase in daily cases in South Korea began. A lot ot people worldwide including the local government blamed a Christian 'Cult' for this, since one member seemed to have spread the virus.

**Claim description in more detail:**

* Without this particular spreader event in the Shincheonji Church in Daegu the Covid-spread would have been seriously lower.
* In fact, one could argue that without those spreader events the Covid-spread in South Korea wouldn't have been "serious" at all.

**Our approach:**

* In order to see, whether the public media was right, and the Church did indeed cause the first "serious" spread of the virus we first had a look at the most common reasons for a Covid infection within South Korea.
* We then created a graph showing the daily cases related to the main spreader events in comparison to the overall daily cases.
* Finally, we created a first map of South Korea showing the outbreaks in the different regions together with the specific locations of the different spreader events.


#### First part of the analyis
**Who was infected by with infection case? What role do the super spreader events play?**
<p>&nbsp;</p>

```{r echo=FALSE, message=FALSE}
# Plotting the main 10 infection cases
top_infection_cases <- patientinfo %>% count(infection_case) %>% top_n(10, n) %>% arrange(desc(n))
ggplot(data = top_infection_cases, aes(x=reorder(infection_case, -n), y=n)) + 
  geom_bar(stat="identity", width = 0.5, fill="red") +
  theme_bw() +
  theme(axis.text.x=element_text(angle=45,hjust=1)) +
  labs(x="Infection Reason", y="Number of Cases", title = "Top 10 Infection Reasons")
```

**Short Analysis:**

* Seems like apart from contact with a patient and oversees inflow, the main reasons for getting Covid-19 were related to some main events that happened throughout the country.
* The most cases are related to the Itaewon clubs. The church that we read about in the news is on 4th place when we don't count contact with patient, overseas inflow etc.

------
Following, we'll create a graph comparing the total daily cases with the daily cases related to the super spreader events. Since the "patientinfo" table represents only a sample of the total amount of cases, we will first show, that patientinfo can indeedn be seen as a representative sample of the total amount of cases.

<p>&nbsp;</p>

```{r echo=FALSE, message=FALSE}
# Graph showing total daily cases over time, patientinfo database
## doesn't matter Leon already defined this 
patientinfo[, daily_cases := .N, by = confirmed_date]
total_cases_patientinfo <- ggplot(data = patientinfo, aes(x=confirmed_date, y=daily_cases)) +
  geom_line(colour="black") + labs(x="Time", y="Cases per Day")

# Graph showing total daily cases over time, time database
## doesn't matter for final markdown, only so this will work here
#total cases in Korea per day
time[,confirmed_date:=as.Date(date,"%d/%m/%y")]
time[, confirmed_date:= as.IDate(confirmed_date)]
total_cases_time <- ggplot(time, aes(x=confirmed_date, y=daily_cases)) + geom_line() +
  labs(x="Time", y="Cases per Day")

# Putting both graphs next to each other to show patientinfo is a sample of time

ggarrange(total_cases_patientinfo, total_cases_time, ncol=2, nrow=1)

```


As one can see both graph lines follow a similar pattern over the same time period. Therefore, we will assume that we can treat patientinfo as a representative sample. 

<p>&nbsp;</p>

```{r echo=FALSE, message=FALSE}
# Calculating the daily cases and adding this as another column
patientinfo[, daily_cases := .N, by = confirmed_date]

# Adding the 5 big Spreader Events to our Graph showing Daily Cases over Time
ggplot(data = patientinfo, aes(x=confirmed_date, y=daily_cases)) +
  geom_line(colour="black") +
  geom_line(data = subset(patientinfo, infection_case=="Shincheonji Church"), aes(colour = "Shincheonji Church")) +
  geom_line(data = subset(patientinfo, infection_case=="Guro-gu Call Center"), aes(colour = "Guro-gu Call Center")) +
  geom_line(data = subset(patientinfo, infection_case=="Itaewon Clubs"), aes(colour = "Itaewon Clubs")) +
  geom_line(data = subset(patientinfo, infection_case=="Coupang Logistics Center"), aes(colour = "Coupang Logistics Center")) +
  geom_line(data = subset(patientinfo, infection_case=="Richway"), aes(colour = "Richway")) +
  labs(x="Time", y="Cases per Day", title = "Daily Cases related to Spreader Events vs. Total Daily Cases") +
  geom_hline(yintercept=100, color="orange") +
  theme(legend.position="bottom", legend.title = element_blank())
```

**Short Analysis:**

* The different spreader events match the daily cases over time pretty well!
* Especially the first event (the Church!) shows that when cases exploded, a whole lot was related to the church everyone is blaming.
* Let's see when exactly the main event happened and match only the first event with overall cases.

<p>&nbsp;</p>

```{r echo=FALSE, message=FALSE}
# Researching Dates of Spreader Events on the internet and creating a data table with the 5 main events
super_spreader <- data.table(Event_Name= c("Itaewon Club", "Richway", "Guro-gu Call Center", "Shincheonji Church", "Coupang Logistics Center"), 
                           Date=c("2020-05-01", "2020-06-01", "2020-03-05", "2020-02-15", "2020-05-20"))
# Convert Date column as date, so we can use it in one graph with our Patientinfo & daily cases
super_spreader[, Date:=as.Date(Date)]

# Showing Date of Shincheonji Church Outbreak and the cases that were connected with this event in one graph
ggplot(data = patientinfo, aes(x=confirmed_date, y=daily_cases)) + geom_line(colour="black") +
  geom_line(data = subset(patientinfo, infection_case=="Shincheonji Church"), colour="red") +
  geom_vline(data = subset(super_spreader, Event_Name=="Shincheonji Church"),
             aes(xintercept = Date, colour = "Shincheonji Church (15. February 2020)")) +
  labs(x="Time", y="Cases per Day", title = "Covid-19 Outbreak after Shincheonji Church Event") +
  theme(legend.position="bottom", legend.title = element_blank())
```


**Short Analysis**

* This matches pretty well.
* Of course we need to take into account that the "real" amount of daily cases goes up to 800 so the almost 150 daily cases at this one day in March connected to the Church are not the total number of cases that day.
* Still, the impact the church outbreak had on the whole Covid situation in South Korea is pretty intense.

<p>&nbsp;</p>

#### Second part of the analyis
**Where exactly did the events take place? Are we able to see a connection between large outbreaks and the Spreader events?**

<p>&nbsp;</p>

```{r echo=FALSE, message=FALSE}
# subsetting to remove empty values in the case data table (no coordinates)
case <- case[longitude != "-"]
# change data type from character to double
case[, latitude := as.double(latitude)][, longitude := as.double(longitude)]

```


```{r echo=FALSE, message=FALSE}
# Looking up exact locations of the main spreader events and adding a data frame with the exact longitude and latitude of every event

world <- ne_countries(scale = "medium", returnclass = "sf")

spreader_event_locations <- data.frame(Event_Name = c("Shincheonji Church", "Itaewon Clubs", "Richway", "Guro-gu Call Center", "Coupang Logistics Center"), 
                                       City = c("Daegu", "Seoul", "Seoul", "Guro-gu", "Gyeonggi"), 
                                       Longitude = c(128.600006, 127.024612, 127.024612, 126.8502, 127.2500), 
                                       Latitude = c(35.866669, 37.532600, 37.532600 ,37.49447,37.5000))


# Adding the locations of the spreader events and also adding some aestetics to make the map look more appealing or real
  ggplot(data = world) +
  geom_sf(fill= "antiquewhite") +
  geom_point(data = case, aes(x=longitude, y=latitude, size = confirmed,
                              color = province)) +
  geom_text_repel(data = spreader_event_locations,
                  aes(x = Longitude,y = Latitude, label = Event_Name), 
    fontface = "bold", nudge_x = c(1, -2, 2, 2, -1),
    nudge_y = c(0.5, -0.5, 0.5, 0.5, -0.5)) +
  coord_sf(xlim = c(125.14, 130.15), ylim = c(33.02, 38.98), expand = FALSE) +
  theme(panel.grid.major = element_line(color = gray(.5),
    linetype = "dashed", size = 0.2),
    panel.background = element_rect(fill = "aliceblue")) +
  labs(title = "Confirmed Covid-cases mapped")
```


**Short Analysis:**

* One can clearly see the connection between large outbreak locations and the spreader events. While multiple cases and events occurred in Seoul (North-West part of South Korea), the most interesting thing is the very first spreader event in Daegu (Shincheonji Church).
* Interesting is as well, that his map shows not only part of the acutal cases (such as the Patientinfo table) but a real overview of the number of cases occurred in the different areas.
* Thus, one can clearly see the influence the main first spreader event in the Shincheonji Church in Daegu had. One could argue that without the event the cases might have been seriously lower. However, further analysis would have had to be conducted in order to confirm this. 

<p>&nbsp;</p>


## Claim 03
#### The average temperature level correlates with daily number of infection cases.

**Our initial motivation:**

* Concerning other viruses it is often said that the temperature level has an significant impact on the daily number of infection cases.
So it is reasonable to inspect whether this is also true for COVID-19.

**Claim description in more detail:**

* Therefore, we analyze the relation between the temperature level and daily infection cases within the period from January to June in 2020. Depending on the results, it might be possible to gain insights for further actions to reduce the number of infection cases.

**Our approach:**

* First, we plot the existing data into a scatter plot in order to see the kind of underlying distribution. For this, we plot the average temperature on the x-axis and the number of daily infection cases on the y-axis. By inspecting the plot we then can decide whether to use a Pearson or Spearman test. Depending on the results of the test, we are able to reject or fail to reject our claim. As we want to show that average temperature level associates with daily number of infection cases our null hypothesis formulates as follows: 
Ho : r = 0. Furthermore, we use the commonly used significance level of alpha = 0.05. Therefore, we will reject Ho if the p-value is below 0.05.


<p>&nbsp;</p>


```{r echo=FALSE, message=FALSE}
#As date
weather[, date:= as.IDate(date)]
timeProvince[,date:=as.Date(date,"%d/%m/%y")]
timeProvince[, date:= as.IDate(date)]

```


```{r echo=FALSE, message=FALSE}
# Combine tables
# Province Sejong is missing in table Weather -> not all confirmed cases can be found in melted_dt
melted_dt <- merge(weather,timeProvince,by=c('province','date'))

# Plot data: avg weather
ggplot(melted_dt,aes(avg_temp,daily_cases,color=ifelse(province=='Daegu', "Daegu", "remaining provinces")))+geom_point() +
  labs(x = "Average Temperature", y = "Cases per Day", 
       title = "Relation: Avg. Temperature vs. Daily Cases (all provinces)") +
  theme(legend.title=element_blank()) 

```

<p>&nbsp;</p>

As can be seen above, the province Daegu has way higher numbers of daily infection cases and thus distorts the entire plot whicht is a typical characteristic for an outlier. Therefore, it is seems to be reasonable to plot the data without this province in order to get a better understanding on the relationship between temperature and number of daily infection cases in the remaining provinces. Nevertheless, we already can conclude that the data is not normally distributed. Also, the Spearman correlation test is more robust to outliers than the Pearson correlation test. Thus, we prefer the Spearman correlation test.


<p>&nbsp;</p>


```{r echo=FALSE, message=FALSE}

# Data without province Daegu (Shincheonji church is located there -> Superspreader Event)
# Prepare data
melted_dt_without_Daegu = melted_dt[province!='Daegu']
# Plot data: avg weather
ggplot(melted_dt_without_Daegu,aes(avg_temp,daily_cases))+geom_point() +
  geom_smooth(method = "loess") +
  labs(x = "Average Temperature", y = "Cases per Day", 
       title = "Relation: Avg. Temperature vs. Daily Cases (without Daegu)") +
  theme(legend.title=element_blank()) 


```

<p>&nbsp;</p>

Without the data from the province Daegu it is possible to rectify the data points. However, no considerable correlation between the to variables can be seen.

<p>&nbsp;</p>

```{r echo=FALSE, message=FALSE}
cor_temp_spear <- cor(melted_dt$avg_temp, melted_dt$daily_cases, method = 'spearman')

test <-cor.test(melted_dt$avg_temp,melted_dt$daily_cases,method="spearman")
test

p_value <- test$p.value
p_value


```

**Interpretation:**

The p-value of our performed Spearman correlation test is ~0.257 while our alpha-value is 0.05. 
As ~0.257 > 0.05 we fail to reject our Ho. Therefore, under the given circumstances, we have no evidence to suggest that there might be a significant correlation between the average temperature and the number of daily infection cases. 

<p>&nbsp;</p>

## Claim 04
#### Search Data Cases.

**Our initial motivation:**

* We assume that the coronavirus had been spreading several months before cases were officially reported. To support our claim, we use available search data.

**Claim description in more detail:**

* The number of searches for covid-related symptoms shows an increase in the beginning of the pandemic (Beginning of 2020)
* The number of daily confirmed cases correlates with the searches for covid-related symptoms

**Our approach:**

We join the tables patientInfo and Searchtrend by confirmed_date.
Then, we plot the number of daily cases and searches as line chart.
As the search data is not comparable with the daily confirmed cases on the same scale, we introduce
an additional y-Axis for the search data.
As the data for the search volume contains many values below 0.0001, we multiply the scale for the data with 10.000.

<p>&nbsp;</p>

```{r echo=FALSE, message=FALSE}

#create new column for number of daily cases, based on count of confirmed_date
patientinfo_copy = copy(patientinfo)
patientinfo_copy <- patientinfo_copy[, daily_cases := .N, by = confirmed_date]


#rename confirmed_date to date (otherwise not able to join)
patientinfo_copy[, date := sub("confirmed_date", "date", confirmed_date)]
#change date class to "IDate"
patientinfo_copy[, date:= as.IDate(date)]

#full outer join of patientinfo and searchtrend
search_patient <- merge(patientinfo_copy, searchtrend, by = "date", all = TRUE)

#set colour for visualization
searchcolour <- "#00c7c6"
dailycasecolour <- "#ff0000"

# coronavirus search volume & daily cases
ggplot(search_patient[date >= "2020-01-01" & date < "2020-05-01"], aes(x=date)) +
  scale_x_date(date_breaks = "1 month", date_labels = "%b %y")+
  geom_line(aes(y=daily_cases, col = "Daily Cases")) +
  geom_line(aes(y=coronavirus*1.5, col = "Searches for 'coronavirus'")) +
  labs(title="Daily Covid Cases & Search Volume for 'coronavirus'", x = "Time")+
  scale_y_continuous(name = "Cases per Day",
    # Add a second axis, with a scale *10k 
  sec.axis = sec_axis(trans=~./1.5*10000, name="Search Volume"))+
  theme(legend.position="right", legend.title = element_blank(), 
        axis.title.y.right = element_text(angle=90, color = searchcolour),
        axis.title.y.left = element_text(color = dailycasecolour))

```

<p>&nbsp;</p>

```{r echo=FALSE, message=FALSE}
  
# flu search volume & daily cases
ggplot(search_patient[date >= "2019-09-01" & date < "2020-05-01"], aes(x=date)) +
  scale_x_date(date_breaks = "2 month", date_labels = "%b %y")+
  geom_line(aes(y=daily_cases, col = "Daily Cases")) +
  geom_line(aes(y=flu*100, col = "Searches for 'flu'")) +
  labs(title="Daily Covid Cases & Search Volume for 'flu'", x = "Time")+
  scale_y_continuous(
    name = "Cases per Day",
    # Add a second axis, with a scale *10k 
    sec.axis = sec_axis(trans=~./100*10000, name="Search Volume"))+
  theme(legend.position="right", legend.title = element_blank(), 
        axis.title.y.right = element_text(angle=90, color = searchcolour),
        axis.title.y.left = element_text(color = dailycasecolour))
```

<p>&nbsp;</p>

```{r echo=FALSE, message=FALSE}

# cold search volume & daily cases
#setting colour
searchcolour <- "#00c7c6"
dailycasecolour <- "#ff0000"

ggplot(search_patient[date >= "2019-12-20" & date < "2020-05-01"], aes(x=date)) +
  scale_x_date(date_breaks = "1 month", date_labels = "%b %y")+
  geom_line(aes(y=daily_cases, col = "Daily Cases")) +
  geom_line(aes(y=cold*30, col = "Searches for 'cold'")) +
  labs(title="Daily Covid Cases & Search Volume for 'cold'", x = "Time")+
  scale_y_continuous(
    # Features of the first axis
    name = "Cases per Day",
    # Add a second axis and specify its features
    sec.axis = sec_axis(trans=~./30*10000, name="Search Volume"))+
  theme(legend.position="right", legend.title = element_blank(), 
        axis.title.y.right = element_text(angle=90, color = searchcolour),
        axis.title.y.left = element_text(color = dailycasecolour))

```

**Short Analysis**

* The term "coronavirus" was searched many times more often in comparison to the other two available search terms "flu" and "cold".
* Both the search term "coronavirus" and "cold" show partial similarity in its course with the daily confirmed cases (e.g. strong increase in mid-February).
* The gradual increase of the search term "flu" starting in October 2019 could be an indicator of the first (not-tested) covid cases. But there is further investigation needed to differentiate the data from the annual flu-season.



